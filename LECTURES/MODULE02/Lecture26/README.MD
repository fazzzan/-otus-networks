OTUS 20210528

# BGP. Attributes #
![](pictures/01.jpg)

Виды атрибутов

- Хорошо известные (их знают все реализации BGP, и могут передаваться соседям как обязательно, так и передаваться только если реализация об этом атрибует знает)
![](pictures/02.jpg)

- Опциональные (не обязательно все реализации BGP их нзанют, и могут передаваться, а могут и не передаваться)
![](pictures/03.jpg)

Итак, еще раз табличка:
![](pictures/04.jpg)

## BGP Origin ##

Говорит о том, как откуда этот префикс взялся в материале для исходящих маршрутов
![](pictures/05.jpg)

![](pictures/06.jpg)
- 0 = i - входящий маршрут от IGP (маршруты. которые были заданы ключевым словом ```network```, или префикс транслировался с уже присвоенным атрибутом через нашу AS)
- 1 = e - входящий маршрут от EGP (этот протокол уже практически не используется)
- 2 = ? - BGP не уверен откуда этот маршрут

![](pictures/08.jpg)

Также код можно задать вручную (как у входящего, так и у исходящего)

![](pictures/07.jpg)

## BGP Aggregate ##

Необходимо, в случае возможной агрегации. Агрегация - значит что какой-либо набор подсетей находится за каким-либо пиром

![](pictures/09.jpg)

AS_SEQUENCE - Пиру даем понять, что запись AS необходимо воспринимать как последовательную запись AS, и это относится как к неагрегированному, так и к агрегированному AS-PATH

![](pictures/10.jpg)

AS_SET - Возникает дополнительно к AS_SEQUENCE: даем пиру понять, что в агрегированном апдейте путь не может быть точным, так как специфик пути возможно располагаются параллельно.

![](pictures/11.jpg)

![](pictures/12.jpg)

Настройка

Выполняется в контексте BGP
![](pictures/13.jpg)

as-set - всегда задается вручную, но только для тех апдейтов, которые не содержат суммарного маршрута, там это просто не сработает. Агрегируют магистральные провайдеры

summary-only - анонс суммарного маршрута, без специфичных маршрутов

![](pictures/14.jpg)

![](pictures/15.jpg)

## Atomic Aggregate/AGGREGATOR ##

помимо AS-Path, в UPD с агрегацией направляется флаг, который говорит что была агрегация. 

![](pictures/16.jpg)

![](pictures/17.jpg)

В связку с atomic aggregate устанавливается атрибут ___AGGREGATE___. В этом случае видно: кто произвел агрегацию

![](pictures/18.jpg)

## MED ##
Опциональный, нетранзитивный, тлько мажду пирами разных AS. Аналог веса/приоритета. Передача MED через AS не разрешена, срезается автоматически. Рекомендуется не использовать данный атрибут. по-умолчанию MED = 100. 

Local Preference - приоритетнее MED и если на входе AS34 он будет задан, то на MED никто внимания не обратит.

![](pictures/19.jpg)

![](pictures/20.jpg)

![](pictures/21.jpg)

## WEIGHT ##

Необязательный (нет в таблице атрибутов) специфичный для Cisco. Необходима для приоритезации префиксов. Настраивается только локально, не передается соседям. Надо настраивать на всех R, где необходимо Чем больше - тем лучше (аналог: статический маршрут всегда выиграет у динамического машрута).

![](pictures/22.jpg)

weight 
- маршрута заданного network = 32768
- полученного от соседа = 0

![](pictures/23.jpg)

